# Prometheus alert rules para LLM hardening (RISK-7)
groups:
  - name: llm_health
    interval: 30s
    rules:
      - alert: LLMProviderDown
        expr: llm_circuit_breaker_state == 1
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "LLM provider {{ $labels.provider }} circuit OPEN"
          description: "Circuit breaker aberto para {{ $labels.provider }} por >2min. Provider pode estar indisponível."

      - alert: LLMHighErrorRate
        expr: rate(llm_requests_total{status="failed"}[5m]) > 0.1
        for: 3m
        labels:
          severity: warning
        annotations:
          summary: "LLM error rate > 10% por 3min"
          description: "Taxa de erro em chamadas LLM excedeu 10% nos últimos 5min (provider {{ $labels.provider }})."

      - alert: LLMHighTimeoutRate
        expr: rate(llm_requests_total{status="timeout"}[5m]) > 0.05
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: "LLM timeout rate > 5% por 2min"
          description: "Taxa de timeout em chamadas LLM excedeu 5% nos últimos 5min (provider {{ $labels.provider }})."
